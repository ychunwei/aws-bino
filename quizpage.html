<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Quiz</title>
    <link rel="stylesheet" href="quiz.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

</head>

<body>
    <div id="topBar">
        <div id="Search" class="container"></div>

        <div id="BINO" class="page-header">BINO</div>

        <img src="img_avatar.png" alt="Avatar" id="avatar" style="width:60px">
        <p id="avatar_text">Raphael Low<br>Student</p>

         <div id = "sidenav">
             <div id="overview_button">
                <svg id="icon" width="25px" height="25px" viewBox="0 0 16 16" class="bi bi-chevron-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                </svg>
                <div id="overview_text" x="50" y="35" fill="black">Overview</div>
             </div>
            
            <svg width = "300" height = "600">
                <g>
                    <rect rx="25" ry="25" width = "250" height = "260" fill="white"></rect>
                    <text class="sidenavweek" x="40" y="35" fill="Orange">Week 0</text>
                    <line x1="50" y1="50" x2="50" y2="235" stroke-linecap="round" d="M5 40 l215 0" style="stroke:rgba(249, 220, 215, 1); stroke-width:4" />
                    <line x1="50" y1="50" x2="50" y2="200" stroke-linecap="round" d="M5 40 l215 0" style="stroke:orange; stroke-width:4" />
                    <text class="sidenavweek2" x="70" y="85">Lecture 1</text>
                    <text class="sidenavweek2" x="70" y="135">Lecture 2</text>
                    <text class="sidenavweek2" x="70" y="185">Lecture 3</text>
                    <text id="sidebarquiz" class="sidenavweek2" x="70" y="235">Quiz</text>
                    <text class="sidenavweek" x="40" y="300" fill = "Grey">Week 1</text>
                    <text class="sidenavweek" x="40" y="350" fill = "Grey">Week 2</text>
                    <text class="sidenavweek" x="40" y="400" fill = "Grey">Week 3</text>
                </g>
            </svg>
        </div>
    </div>

    

    
    <div id="main_section" class="col-6 offset-3">
        <div id="quiz_content" class="container">
          
          
            <div id = "quiz_text">Alkanes (C1003)</div>
            <div id = "quiz_text2">25 Questions | 30 Minutes</div>
            <div class="progress" style="height: 10px">
              <div id="progressbarr" class="progress-bar" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <hr>
            <div id = "quiz_options">
              <p id="demo"></p>
              <div class="temp" id="answer">Answer</div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="A">
                    <label class="form-check-label" for="exampleRadios1" id="demoo1">
                      Default radio
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="B">
                    <label class="form-check-label" for="exampleRadios2" id="demoo2">
                      Second default radio
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios3" value="C">
                    <label class="form-check-label" for="exampleRadios3" id="demoo3">
                      Disabled radio
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios4" value="D">
                    <label class="form-check-label" for="exampleRadios4" id="demoo4">
                      Disabled radio
                    </label>
                </div>
                
                <hr>
            </div>
            
            <div id = "quiz_options">
                <p id="demo1"></p>
                <div class="temp" id="answer1">Answer</div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios1" id="exampleRadios11" value="A">
                    <label class="form-check-label" for="exampleRadios11" id="demoo11">
                      Default radio
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios1" id="exampleRadios21" value="B">
                    <label class="form-check-label" for="exampleRadios21" id="demoo21">
                      Second default radio
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios1" id="exampleRadios31" value="C">
                    <label class="form-check-label" for="exampleRadios31" id="demoo31">
                      Disabled radio
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios1" id="exampleRadios41" value="D">
                    <label class="form-check-label" for="exampleRadios41" id="demoo41">
                      Disabled radio
                    </label>
                </div>
        
                <hr>
            </div>

            <div id = "quiz_options">
              <p id="demo2"></p>
              <div class="temp" id="answer2">Answer</div>
              <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios2" id="exampleRadios12" value="A">
                  <label class="form-check-label" for="exampleRadios12" id="demoo12">
                    Default radio
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios2" id="exampleRadios22" value="B">
                  <label class="form-check-label" for="exampleRadios22" id="demoo22">
                    Second default radio
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios2" id="exampleRadios32" value="C">
                  <label class="form-check-label" for="exampleRadios32" id="demoo32">
                    Disabled radio
                  </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios2" id="exampleRadios42" value="D">
                    <label class="form-check-label" for="exampleRadios42" id="demoo42">
                      Disabled radio
                    </label>
                </div>
      
                <hr>
            </div>

            <div id = "quiz_options">
              <p id="demo3"></p>
              <div class="temp" id="answer3">Answer</div>
              <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios3" id="exampleRadios13" value="A">
                  <label class="form-check-label" for="exampleRadios13" id="demoo13">
                    Default radio
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios3" id="exampleRadios23" value="B">
                  <label class="form-check-label" for="exampleRadios23" id="demoo23">
                    Second default radio
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios3" id="exampleRadios33" value="C">
                  <label class="form-check-label" for="exampleRadios33" id="demoo33">
                    Disabled radio
                  </label>
              </div>
              <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios3" id="exampleRadios43" value="D">
                  <label class="form-check-label" for="exampleRadios43" id="demoo43">
                    Disabled radio
                  </label>
              </div>
      
              <hr>
            </div>

            <div id = "quiz_options">
              <p id="demo4"></p>
              <div class="temp" id="answer4">Answer</div>
              <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios4" id="exampleRadios14" value="A">
                  <label class="form-check-label" for="exampleRadios14" id="demoo14">
                    Default radio
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios4" id="exampleRadios24" value="B">
                  <label class="form-check-label" for="exampleRadios24" id="demoo24">
                    Second default radio
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios4" id="exampleRadios34" value="C">
                  <label class="form-check-label" for="exampleRadios34" id="demoo34">
                    Disabled radio
                  </label>
              </div>
              <div class="form-check">
                  <input class="form-check-input" type="radio" name="exampleRadios4" id="exampleRadios44" value="D">
                  <label class="form-check-label" for="exampleRadios44" id="demoo44">
                    Disabled radio
                  </label>
              </div>  
          </div>
            <button id="nextbutton" type="button" class="btn btn-primary">Next</button>
          </div>   
    </div>

    <div>
    
<!-- JAVASCRIPT STUFF -->
    <script>
        var jsonObj = new Object()
        var isFinalCalc = 0
        var currentLower = 1.5
        var currentUpper = 3.5
        var currentAverage = (currentLower+currentUpper)/2
        // var snowballCounterDecrease = 0
        // var snowballCounterIncrease = 0
        // var previous
        var array = []
        var questionNumber = 1
        

        fetch('http://awsbino-env-2.eba-vh6jpy5i.us-east-1.elasticbeanstalk.com/ini')
        .then((response) => {
            return response.json()
        })
        .then((data) => {
          isFinalCalc = isFinalCalc + 1
          displayQuestion(data)
          })

        .catch((err) => {
            console.error('There has been a problem with your fetch operation: ' + err);
        })

        
      function displayQuestion(questionsToBe) {
        
        var filteredArray = []
        const jsonStr = JSON.stringify(questionsToBe)
        const obj = JSON.parse(jsonStr)

        if (isFinalCalc > 1) {
          currentAverage = obj.currentAverage
          currentLower = obj.currentLower
          currentUpper = obj.currentUpper
        }
        

        if (isFinalCalc <= 5) {
          const obj2 = JSON.parse(obj.data)
          // console.log(obj.id_of_qn)
          var list = obj.id_of_qn
          var list1 = []
  
          // var list = [JSON.stringify(obj.id_of_qn)]
          // console.log("list in ini" + list)
          // var list2 = list[0]
          // console.log(list2)

          if (obj.isSnowball == true) {
            console.log("BOOOSTED!!")
          }

          array = obj2.Items

          if (isFinalCalc > 1) {
            list1 = Object.values(list)
            // console.log(typeof list1)
          }

          if (obj.currentAverage < 1.9) {
            localStorage.setItem("currentAverage", ((currentUpper + currentLower) / 2).toFixed(3))
            window.open('./performance_report.html')
          }
            var count = 0
            var countLow = 0
            var countHigh = 0

            // console.log(array.length)
            for (let i=0; i < array.length; i++) {
              if (Number(array[i]['Difficulty']['S']) > currentUpper && !list1.includes(array[i]['Qns_ID']['S'])) {
                count++
                if (count > 1) {
                  //console.log("pushed")
                  list1.push(array[i]['Qns_ID']['S'])
                }
              }

              else if (currentLower < Number(array[i]['Difficulty']['S']) && Number(array[i]['Difficulty']['S']) < currentAverage && !list1.includes(array[i]['Qns_ID']['S'])) {
                // console.log("counthigh" +countHigh)
                // console.log(array[i]['Qns_ID']['S'])
                countHigh++
                if (countHigh > 2) {
                  list1.push(array[i]['Qns_ID']['S'])
                }
              }

              else if (currentAverage < Number(array[i]['Difficulty']['S']) && Number(array[i]['Difficulty']['S']) < currentUpper && !list1.includes(array[i]['Qns_ID']['S'])) {
                // console.log("countlow" + countLow)
                // console.log(array[i]['Qns_ID']['S'])
                countLow++
                if (countLow > 3) {
                  list1.push(array[i]['Qns_ID']['S'])
                }
              }
            }

            

            // console.log(list1)
            // console.log(array)
            for (let i=0; i < array.length; i++) {
              if (!list1.includes(array[i]['Qns_ID']['S'])) {
                  // console.log("pushed!" + array[i]['Qns_ID']['S'])
                  filteredArray.push(array[i])
                }
            }

            if (filteredArray.length < 5) {
              filteredArray.push(array[21])
              filteredArray.push(array[16])
              filteredArray.push(array[20])
            }
            // console.log(filteredArray.length)
            // console.log(filteredArray)
          
        }

        // if (isFinalCalc != 1) {
        //     //SNOWBALL EFFECT
        //     //snowball(previous,currentAverage)

        //   // if (isFinalCalc => 3) {
        //   //   if (k => 0.8) {
        //   //     currentUpper = currentUpper*(1 + k * 0.1)
        //   //   }
        //   // }
        // }

        console.log("<---SUBSECTION--->")
        
        console.log("currentLower: " + currentLower)
        console.log("currentAverage: " + currentAverage)
        console.log("currentUpper: " + currentUpper)
      

        if (isFinalCalc == 6) {
            localStorage.setItem("currentAverage", currentAverage)
            window.open('./performance_report.html')
            return
          }

        //console.log(array)

        // console.log('Questions for this subsection (ID | Difficulty | Answer):')
        // console.log(filteredArray[0]['Qns_ID']['S'] + " | " + filteredArray[0]['Difficulty']['S'] + " | " + filteredArray[0]['Answer']['S'])
        // console.log(filteredArray[1]['Qns_ID']['S'] + " | " + filteredArray[1]['Difficulty']['S'] + " | " + filteredArray[1]['Answer']['S'])
        // console.log(filteredArray[2]['Qns_ID']['S'] + " | " + filteredArray[2]['Difficulty']['S'] + " | " + filteredArray[2]['Answer']['S'])
        // console.log(filteredArray[3]['Qns_ID']['S'] + " | " + filteredArray[3]['Difficulty']['S'] + " | " + filteredArray[3]['Answer']['S'])
        // console.log(filteredArray[4]['Qns_ID']['S'] + " | " + filteredArray[4]['Difficulty']['S'] + " | " + filteredArray[4]['Answer']['S'])
        document.getElementById("answer").innerHTML = filteredArray[0]['Difficulty']['S'] + " | " + filteredArray[0]['Answer']['S']
        document.getElementById("answer1").innerHTML = filteredArray[1]['Difficulty']['S'] + " | " + filteredArray[1]['Answer']['S']
        document.getElementById("answer2").innerHTML = filteredArray[2]['Difficulty']['S'] + " | " + filteredArray[2]['Answer']['S']
        document.getElementById("answer3").innerHTML = filteredArray[3]['Difficulty']['S'] + " | " + filteredArray[3]['Answer']['S']
        document.getElementById("answer4").innerHTML = filteredArray[4]['Difficulty']['S'] + " | " + filteredArray[4]['Answer']['S']

        
        document.getElementById("demo").innerHTML = `Q${questionNumber++}. `+ filteredArray[0]['Question']['S']
        document.getElementById("demo1").innerHTML = `Q${questionNumber++}. `+ filteredArray[1]['Question']['S']
        document.getElementById("demo2").innerHTML = `Q${questionNumber++}. `+ filteredArray[2]['Question']['S']
        document.getElementById("demo3").innerHTML = `Q${questionNumber++}. `+ filteredArray[3]['Question']['S']
        document.getElementById("demo4").innerHTML = `Q${questionNumber++}. `+ filteredArray[4]['Question']['S']

        
        document.getElementById('demoo1').innerHTML = filteredArray[0]['Option_A']['S']
        document.getElementById('demoo2').innerHTML = filteredArray[0]['Option_B']['S']
        document.getElementById('demoo3').innerHTML = filteredArray[0]['Option_C']['S']
        document.getElementById('demoo4').innerHTML = filteredArray[0]['Option_D']['S']

        
        document.getElementById('demoo11').innerHTML = filteredArray[1]['Option_A']['S']
        document.getElementById('demoo21').innerHTML = filteredArray[1]['Option_B']['S']
        document.getElementById('demoo31').innerHTML = filteredArray[1]['Option_C']['S']
        document.getElementById('demoo41').innerHTML = filteredArray[1]['Option_D']['S']


        document.getElementById('demoo12').innerHTML = filteredArray[2]['Option_A']['S']
        document.getElementById('demoo22').innerHTML = filteredArray[2]['Option_B']['S']
        document.getElementById('demoo32').innerHTML = filteredArray[2]['Option_C']['S']
        document.getElementById('demoo42').innerHTML = filteredArray[2]['Option_D']['S']


        document.getElementById('demoo13').innerHTML = filteredArray[3]['Option_A']['S']
        document.getElementById('demoo23').innerHTML = filteredArray[3]['Option_B']['S']
        document.getElementById('demoo33').innerHTML = filteredArray[3]['Option_C']['S']
        document.getElementById('demoo43').innerHTML = filteredArray[3]['Option_D']['S']


        document.getElementById('demoo14').innerHTML = filteredArray[4]['Option_A']['S']
        document.getElementById('demoo24').innerHTML = filteredArray[4]['Option_B']['S']
        document.getElementById('demoo34').innerHTML = filteredArray[4]['Option_C']['S']
        document.getElementById('demoo44').innerHTML = filteredArray[4]['Option_D']['S']

        document.getElementById("nextbutton").addEventListener("click", storeAns, false);
        
        function storeAns() {

          scroll(0,0)


          var val1,
          element = document.querySelector('input[name="exampleRadios"]:checked');
          if (element != null) {
              val1 = [filteredArray[0]['Qns_ID']['S'], Number(filteredArray[0]['Difficulty']['S']), filteredArray[0]['Skillset']['S'], element.value];
          }
          else {
              val1 = [filteredArray[0]['Qns_ID']['S'], Number(filteredArray[0]['Difficulty']['S']), filteredArray[0]['Skillset']['S'], null];
          }

          var val2,
          element = document.querySelector('input[name="exampleRadios1"]:checked');
          if (element != null) {
              val2 = [filteredArray[1]['Qns_ID']['S'], Number(filteredArray[1]['Difficulty']['S']), filteredArray[1]['Skillset']['S'], element.value];
          }
          else {
              val2 = [filteredArray[1]['Qns_ID']['S'], Number(filteredArray[1]['Difficulty']['S']), filteredArray[1]['Skillset']['S'], null];
          }

          var val3,
          element = document.querySelector('input[name="exampleRadios2"]:checked');
          if (element != null) {
              val3 = [filteredArray[2]['Qns_ID']['S'], Number(filteredArray[2]['Difficulty']['S']), filteredArray[2]['Skillset']['S'], element.value];
          }
          else {
              val3 = [filteredArray[2]['Qns_ID']['S'], Number(filteredArray[2]['Difficulty']['S']), filteredArray[2]['Skillset']['S'], null];
          }

          var val4,
          element = document.querySelector('input[name="exampleRadios3"]:checked');
          if (element != null) {
              val4 = [filteredArray[3]['Qns_ID']['S'], Number(filteredArray[3]['Difficulty']['S']), filteredArray[3]['Skillset']['S'], element.value];
          }
          else {
              val4 = [filteredArray[3]['Qns_ID']['S'], Number(filteredArray[3]['Difficulty']['S']), filteredArray[3]['Skillset']['S'], null];
          }

          var val5,
          element = document.querySelector('input[name="exampleRadios4"]:checked');
          if (element != null) {
              val5 = [filteredArray[4]['Qns_ID']['S'], Number(filteredArray[4]['Difficulty']['S']), filteredArray[4]['Skillset']['S'], element.value];
          }
          else {
              val5 = [filteredArray[4]['Qns_ID']['S'], Number(filteredArray[4]['Difficulty']['S']), filteredArray[4]['Skillset']['S'], null];
          }

            jsonObj.isFinal = false

            if (isFinalCalc == 4) {
              document.getElementById('nextbutton').outerHTML = "<button id='nextbutton' type='button' class='btn btn-primary'>Submit</button>";
            }

            if (isFinalCalc == 5) {
              jsonObj.isFinal = true
            }

            jsonObj.isFinalCalc = isFinalCalc
            // console.log(isFinalCalc)
            jsonObj.currentLower  = currentLower
            jsonObj.currentUpper = currentUpper
            jsonObj.currentAverage = currentAverage

            // console.log(jsonObj)
            jsonObj.qnpairs = [val1,val2,val3,val4,val5]
            var jsonString= JSON.stringify(jsonObj)
            // console.log(jsonString)

            fetch('http://awsbino-env-2.eba-vh6jpy5i.us-east-1.elasticbeanstalk.com/checkans', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: jsonString
            })
            .then(response => {
              return response.json()
            })
            .then((data) => {
              isFinalCalc++
              // console.log(isFinalCalc)
              // console.log(data)

              var ele = document.getElementsByName("exampleRadios");
              for(var i=0;i<ele.length;i++)
                  ele[i].checked = false;
              
              var ele1 = document.getElementsByName("exampleRadios1");
              for(var i=0;i<ele1.length;i++)
                  ele1[i].checked = false;

              var ele2 = document.getElementsByName("exampleRadios2");
              for(var i=0;i<ele2.length;i++)
                  ele2[i].checked = false;

              var ele3 = document.getElementsByName("exampleRadios3");
              for(var i=0;i<ele3.length;i++)
                  ele3[i].checked = false;

              var ele4 = document.getElementsByName("exampleRadios4");
              for(var i=0;i<ele4.length;i++)
                  ele4[i].checked = false;

              document.getElementById("progressbarr").outerHTML = `<div id='progressbarr' class='progress-bar bg-warning' role='progressbar' style='width:${questionNumber * 4}%' aria-valuenow='25' aria-valuemin='0' aria-valuemax='100'></div>`

              displayQuestion(data)


            })
            .catch(err => {
              console.log(err)
            })

            document.getElementById("nextbutton").removeEventListener("click",storeAns)
        }
      }

      function snowball(previous,current) {
        if (current - previous > 0.45 && current > previous) {
          console.log("+1 POSITIVE SNOWBALL EFFECT")
          
          snowballCounterIncrease++
          if (snowballCounterIncrease > 1) {
            console.log("BOOOOOOOSTED")
            currentUpper = currentUpper + 0.5
            currentLower = currentLower + 0.5
            //gives you bonus marks
          }
        }

        else if (current - previous < -0.45 && current < previous ) {
          console.log("+1 NEGATIVE SNOWBALL EFFECT")
          
          snowballCounterDecrease++
          if (snowballCounterDecrease > 1) {
            window.location.replace('./performance_report.html')
            //ask to redo the quiz when youre better
          }
        }
      
      }

    </script>

</body>

</html>